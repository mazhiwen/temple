{"version":3,"file":"immer.js","sources":["../src/common.js","../src/proxy.js","../src/es5.js","../src/immer.js"],"sourcesContent":["export const PROXY_STATE =\n    typeof Symbol !== \"undefined\"\n        ? Symbol(\"immer-proxy-state\")\n        : \"__$immer_state\"\n\nexport const RETURNED_AND_MODIFIED_ERROR =\n    \"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.\"\n\nfunction verifyMinified() {}\n\nconst inProduction =\n    (typeof process !== \"undefined\" && process.env.NODE_ENV === \"production\") ||\n    verifyMinified.name !== \"verifyMinified\"\n\nlet autoFreeze = !inProduction\nlet useProxies = typeof Proxy !== \"undefined\"\n\n/**\n * Automatically freezes any state trees generated by immer.\n * This protects against accidental modifications of the state tree outside of an immer function.\n * This comes with a performance impact, so it is recommended to disable this option in production.\n * It is by default enabled.\n *\n * @returns {void}\n */\nexport function setAutoFreeze(enableAutoFreeze) {\n    autoFreeze = enableAutoFreeze\n}\n\nexport function setUseProxies(value) {\n    useProxies = value\n}\n\nexport function getUseProxies() {\n    return useProxies\n}\n\nexport function isProxy(value) {\n    return !!value && !!value[PROXY_STATE]\n}\n\nexport function isProxyable(value) {\n    if (!value) return false\n    if (typeof value !== \"object\") return false\n    if (Array.isArray(value)) return true\n    const proto = Object.getPrototypeOf(value)\n    return proto === null || proto === Object.prototype\n}\n\nexport function freeze(value) {\n    if (autoFreeze) {\n        Object.freeze(value)\n    }\n    return value\n}\n\nexport function shallowCopy(value) {\n    if (Array.isArray(value)) return value.slice()\n    if (value.__proto__ === undefined)\n        return Object.assign(Object.create(null), value)\n    return Object.assign({}, value)\n}\n\nexport function each(value, cb) {\n    if (Array.isArray(value)) {\n        for (let i = 0; i < value.length; i++) cb(i, value[i])\n    } else {\n        for (let key in value) cb(key, value[key])\n    }\n}\n\nexport function has(thing, prop) {\n    return Object.prototype.hasOwnProperty.call(thing, prop)\n}\n\n// given a base object, returns it if unmodified, or return the changed cloned if modified\nexport function finalize(base) {\n    if (isProxy(base)) {\n        const state = base[PROXY_STATE]\n        if (state.modified === true) {\n            if (state.finalized === true) return state.copy\n            state.finalized = true\n            return finalizeObject(\n                useProxies ? state.copy : (state.copy = shallowCopy(base)),\n                state\n            )\n        } else {\n            return state.base\n        }\n    }\n    finalizeNonProxiedObject(base)\n    return base\n}\n\nfunction finalizeObject(copy, state) {\n    const base = state.base\n    each(copy, (prop, value) => {\n        if (value !== base[prop]) copy[prop] = finalize(value)\n    })\n    return freeze(copy)\n}\n\nfunction finalizeNonProxiedObject(parent) {\n    // If finalize is called on an object that was not a proxy, it means that it is an object that was not there in the original\n    // tree and it could contain proxies at arbitrarily places. Let's find and finalize them as well\n    if (!isProxyable(parent)) return\n    if (Object.isFrozen(parent)) return\n    each(parent, (i, child) => {\n        if (isProxy(child)) {\n            parent[i] = finalize(child)\n        } else finalizeNonProxiedObject(child)\n    })\n    // always freeze completely new data\n    freeze(parent)\n}\n\nexport function verifyReturnValue(returnedValue, proxy, isProxyModified) {\n    if (returnedValue !== undefined && returnedValue !== proxy) {\n        // something was returned, and it wasn't the proxy itself\n        if (isProxyModified)\n            throw new Error(\n                \"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.\"\n            )\n    }\n}\n\nexport function is(x, y) {\n    // From: https://github.com/facebook/fbjs/blob/c69904a511b900266935168223063dd8772dfc40/packages/fbjs/src/core/shallowEqual.js\n    if (x === y) {\n        return x !== 0 || 1 / x === 1 / y\n    } else {\n        return x !== x && y !== y\n    }\n}\n","\"use strict\"\n// @ts-check\n\nimport {\n    is,\n    has,\n    isProxyable,\n    isProxy,\n    freeze,\n    PROXY_STATE,\n    finalize,\n    shallowCopy,\n    RETURNED_AND_MODIFIED_ERROR,\n    each\n} from \"./common\"\n\nlet proxies = null\n\nconst objectTraps = {\n    get,\n    has(target, prop) {\n        return prop in source(target)\n    },\n    ownKeys(target) {\n        return Reflect.ownKeys(source(target))\n    },\n    set,\n    deleteProperty,\n    getOwnPropertyDescriptor,\n    defineProperty,\n    setPrototypeOf() {\n        throw new Error(\"Don't even try this...\")\n    }\n}\n\nconst arrayTraps = {}\neach(objectTraps, (key, fn) => {\n    arrayTraps[key] = function() {\n        arguments[0] = arguments[0][0]\n        return fn.apply(this, arguments)\n    }\n})\n\nfunction createState(parent, base) {\n    return {\n        modified: false,\n        finalized: false,\n        parent,\n        base,\n        copy: undefined,\n        proxies: {}\n    }\n}\n\nfunction source(state) {\n    return state.modified === true ? state.copy : state.base\n}\n\nfunction get(state, prop) {\n    if (prop === PROXY_STATE) return state\n    if (state.modified) {\n        const value = state.copy[prop]\n        if (value === state.base[prop] && isProxyable(value))\n            // only create proxy if it is not yet a proxy, and not a new object\n            // (new objects don't need proxying, they will be processed in finalize anyway)\n            return (state.copy[prop] = createProxy(state, value))\n        return value\n    } else {\n        if (has(state.proxies, prop)) return state.proxies[prop]\n        const value = state.base[prop]\n        if (!isProxy(value) && isProxyable(value))\n            return (state.proxies[prop] = createProxy(state, value))\n        return value\n    }\n}\n\nfunction set(state, prop, value) {\n    if (!state.modified) {\n        if (\n            (prop in state.base && is(state.base[prop], value)) ||\n            (has(state.proxies, prop) && state.proxies[prop] === value)\n        )\n            return true\n        markChanged(state)\n    }\n    state.copy[prop] = value\n    return true\n}\n\nfunction deleteProperty(state, prop) {\n    markChanged(state)\n    delete state.copy[prop]\n    return true\n}\n\nfunction getOwnPropertyDescriptor(state, prop) {\n    const owner = state.modified\n        ? state.copy\n        : has(state.proxies, prop) ? state.proxies : state.base\n    const descriptor = Reflect.getOwnPropertyDescriptor(owner, prop)\n    if (descriptor && !(Array.isArray(owner) && prop === \"length\"))\n        descriptor.configurable = true\n    return descriptor\n}\n\nfunction defineProperty() {\n    throw new Error(\n        \"Immer does currently not support defining properties on draft objects\"\n    )\n}\n\nfunction markChanged(state) {\n    if (!state.modified) {\n        state.modified = true\n        state.copy = shallowCopy(state.base)\n        // copy the proxies over the base-copy\n        Object.assign(state.copy, state.proxies) // yup that works for arrays as well\n        if (state.parent) markChanged(state.parent)\n    }\n}\n\n// creates a proxy for plain objects / arrays\nfunction createProxy(parentState, base) {\n    const state = createState(parentState, base)\n    const proxy = Array.isArray(base)\n        ? Proxy.revocable([state], arrayTraps)\n        : Proxy.revocable(state, objectTraps)\n    proxies.push(proxy)\n    return proxy.proxy\n}\n\nexport function produceProxy(baseState, producer) {\n    const previousProxies = proxies\n    proxies = []\n    try {\n        // create proxy for root\n        const rootProxy = createProxy(undefined, baseState)\n        // execute the thunk\n        const returnValue = producer.call(rootProxy, rootProxy)\n        // and finalize the modified proxy\n        let result = finalize(rootProxy)\n        // check whether the draft was modified and/or a value was returned\n        if (returnValue !== undefined && returnValue !== rootProxy) {\n            // something was returned, and it wasn't the proxy itself\n            if (rootProxy[PROXY_STATE].modified)\n                throw new Error(RETURNED_AND_MODIFIED_ERROR)\n            result = returnValue\n        }\n        // revoke all proxies\n        each(proxies, (_, p) => p.revoke())\n        return result\n    } finally {\n        proxies = previousProxies\n    }\n}\n","\"use strict\"\n// @ts-check\n\nimport {\n    is,\n    isProxyable,\n    isProxy,\n    freeze,\n    PROXY_STATE,\n    shallowCopy,\n    RETURNED_AND_MODIFIED_ERROR,\n    each,\n    finalize\n} from \"./common\"\n\nconst descriptors = {}\nlet states = null\n\nfunction createState(parent, proxy, base) {\n    return {\n        modified: false,\n        hasCopy: false,\n        parent,\n        base,\n        proxy,\n        copy: undefined,\n        finished: false,\n        finalizing: false,\n        finalized: false\n    }\n}\n\nfunction source(state) {\n    return state.hasCopy ? state.copy : state.base\n}\n\nfunction get(state, prop) {\n    assertUnfinished(state)\n    const value = source(state)[prop]\n    if (!state.finalizing && value === state.base[prop] && isProxyable(value)) {\n        // only create a proxy if the value is proxyable, and the value was in the base state\n        // if it wasn't in the base state, the object is already modified and we will process it in finalize\n        prepareCopy(state)\n        return (state.copy[prop] = createProxy(state, value))\n    }\n    return value\n}\n\nfunction set(state, prop, value) {\n    assertUnfinished(state)\n    if (!state.modified) {\n        if (is(source(state)[prop], value)) return\n        markChanged(state)\n        prepareCopy(state)\n    }\n    state.copy[prop] = value\n}\n\nfunction markChanged(state) {\n    if (!state.modified) {\n        state.modified = true\n        if (state.parent) markChanged(state.parent)\n    }\n}\n\nfunction prepareCopy(state) {\n    if (state.hasCopy) return\n    state.hasCopy = true\n    state.copy = shallowCopy(state.base)\n}\n\n// creates a proxy for plain objects / arrays\nfunction createProxy(parent, base) {\n    const proxy = shallowCopy(base)\n    each(base, i => {\n        Object.defineProperty(proxy, \"\" + i, createPropertyProxy(\"\" + i))\n    })\n    const state = createState(parent, proxy, base)\n    createHiddenProperty(proxy, PROXY_STATE, state)\n    states.push(state)\n    return proxy\n}\n\nfunction createPropertyProxy(prop) {\n    return (\n        descriptors[prop] ||\n        (descriptors[prop] = {\n            configurable: true,\n            enumerable: true,\n            get() {\n                return get(this[PROXY_STATE], prop)\n            },\n            set(value) {\n                set(this[PROXY_STATE], prop, value)\n            }\n        })\n    )\n}\n\nfunction assertUnfinished(state) {\n    if (state.finished === true)\n        throw new Error(\n            \"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process?\"\n        )\n}\n\n// this sounds very expensive, but actually it is not that extensive in practice\n// as it will only visit proxies, and only do key-based change detection for objects for\n// which it is not already know that they are changed (that is, only object for which no known key was changed)\nfunction markChanges() {\n    // intentionally we process the proxies in reverse order;\n    // ideally we start by processing leafs in the tree, because if a child has changed, we don't have to check the parent anymore\n    // reverse order of proxy creation approximates this\n    for (let i = states.length - 1; i >= 0; i--) {\n        const state = states[i]\n        if (state.modified === false) {\n            if (Array.isArray(state.base)) {\n                if (hasArrayChanges(state)) markChanged(state)\n            } else if (hasObjectChanges(state)) markChanged(state)\n        }\n    }\n}\n\nfunction hasObjectChanges(state) {\n    const baseKeys = Object.keys(state.base)\n    const keys = Object.keys(state.proxy)\n    return !shallowEqual(baseKeys, keys)\n}\n\nfunction hasArrayChanges(state) {\n    return state.proxy.length !== state.base.length\n}\n\nexport function produceEs5(baseState, producer) {\n    const prevStates = states\n    states = []\n    try {\n        // create proxy for root\n        const rootProxy = createProxy(undefined, baseState)\n        // execute the thunk\n        const returnValue = producer.call(rootProxy, rootProxy)\n        // and finalize the modified proxy\n        each(states, (_, state) => {\n            state.finalizing = true\n        })\n        // find and mark all changes (for parts not done yet)\n        // TODO: store states by depth, to be able guarantee processing leaves first\n        markChanges()\n        let result = finalize(rootProxy)\n        // check whether the draft was modified and/or a value was returned\n        if (returnValue !== undefined && returnValue !== rootProxy) {\n            // something was returned, and it wasn't the proxy itself\n            if (rootProxy[PROXY_STATE].modified)\n                throw new Error(RETURNED_AND_MODIFIED_ERROR)\n            result = returnValue\n        }\n        // make sure all proxies become unusable\n        each(states, (_, state) => {\n            state.finished = true\n        })\n        return result\n    } finally {\n        states = prevStates\n    }\n}\n\nfunction shallowEqual(objA, objB) {\n    //From: https://github.com/facebook/fbjs/blob/c69904a511b900266935168223063dd8772dfc40/packages/fbjs/src/core/shallowEqual.js\n    if (is(objA, objB)) return true\n    if (\n        typeof objA !== \"object\" ||\n        objA === null ||\n        typeof objB !== \"object\" ||\n        objB === null\n    ) {\n        return false\n    }\n    const keysA = Object.keys(objA)\n    const keysB = Object.keys(objB)\n    if (keysA.length !== keysB.length) return false\n    for (let i = 0; i < keysA.length; i++) {\n        if (\n            !hasOwnProperty.call(objB, keysA[i]) ||\n            !is(objA[keysA[i]], objB[keysA[i]])\n        ) {\n            return false\n        }\n    }\n    return true\n}\n\nfunction createHiddenProperty(target, prop, value) {\n    Object.defineProperty(target, prop, {\n        value: value,\n        enumerable: false,\n        writable: true\n    })\n}\n","export {setAutoFreeze, setUseProxies} from \"./common\"\n\nimport {isProxyable, getUseProxies} from \"./common\"\nimport {produceProxy} from \"./proxy\"\nimport {produceEs5} from \"./es5\"\n\n/**\n * produce takes a state, and runs a function against it.\n * That function can freely mutate the state, as it will create copies-on-write.\n * This means that the original state will stay unchanged, and once the function finishes, the modified state is returned\n *\n * @export\n * @param {any} baseState - the state to start with\n * @param {Function} producer - function that receives a proxy of the base state as first argument and which can be freely modified\n * @returns {any} a new state, or the base state if nothing was modified\n */\nexport default function produce(baseState, producer) {\n    // curried invocation\n    if (arguments.length === 1) {\n        const producer = baseState\n        // prettier-ignore\n        if (typeof producer !== \"function\") throw new Error(\"if produce is called with 1 argument, the first argument should be a function\")\n        return function() {\n            const args = arguments\n            return produce(args[0], draft => {\n                args[0] = draft // blegh!\n                return producer.apply(draft, args)\n            })\n        }\n    }\n\n    // prettier-ignore\n    {\n        if (arguments.length !== 2)  throw new Error(\"produce expects 1 or 2 arguments, got \" + arguments.length)\n        if (typeof producer !== \"function\") throw new Error(\"the second argument to produce should be a function\")\n    }\n\n    // it state is a primitive, don't bother proxying at all and just return whatever the producer returns on that value\n    if (typeof baseState !== \"object\" || baseState === null)\n        return producer(baseState)\n    if (!isProxyable(baseState))\n        throw new Error(\n            `the first argument to an immer producer should be a primitive, plain object or array, got ${typeof baseState}: \"${baseState}\"`\n        )\n    return getUseProxies()\n        ? produceProxy(baseState, producer)\n        : produceEs5(baseState, producer)\n}\n"],"names":["PROXY_STATE","Symbol","RETURNED_AND_MODIFIED_ERROR","verifyMinified","inProduction","process","env","NODE_ENV","name","autoFreeze","useProxies","Proxy","setAutoFreeze","enableAutoFreeze","setUseProxies","value","getUseProxies","isProxy","isProxyable","Array","isArray","proto","Object","getPrototypeOf","prototype","freeze","shallowCopy","slice","__proto__","undefined","assign","create","each","cb","i","length","key","has","thing","prop","hasOwnProperty","call","finalize","base","state","modified","finalized","copy","finalizeObject","finalizeNonProxiedObject","parent","isFrozen","child","is","x","y","proxies","objectTraps","target","source","Reflect","ownKeys","Error","arrayTraps","fn","arguments","apply","createState","get","createProxy","set","deleteProperty","getOwnPropertyDescriptor","owner","descriptor","configurable","defineProperty","markChanged","parentState","proxy","revocable","push","produceProxy","baseState","producer","previousProxies","rootProxy","returnValue","result","_","p","revoke","descriptors","states","hasCopy","finalizing","prepareCopy","createPropertyProxy","assertUnfinished","finished","markChanges","hasArrayChanges","hasObjectChanges","baseKeys","keys","shallowEqual","produceEs5","prevStates","objA","objB","keysA","keysB","createHiddenProperty","produce","args","draft"],"mappings":"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"}